
<form id="sampleform" method="post" action="#">
	<fieldset>
		<legend>更新用户</legend>
		<p>
			<label class="required" for="username">用户名:</label><br/>
			<input type="text" id="username" class="full" value="" name="username" disabled="disabled"/>
			<small>e.g. ui.templates</small>
		</p>
		<p>
			<label class="required" for="password">密码:</label><br/>
			<input type="password" id="password" class="full" value="" name="password"/>
		</p>
		<p>
			<label class="required" for="password_confirm">确认密码:</label><br/>
			<input type="password" id="password_confirm" class="full" value="" name="password_confirm"/>
		</p>
		<p>
			<label class="required" for="firstname">姓:</label><br/>
			<input type="text" id="firstname" class="full" value="" name="firstname"/>
		</p>
		<p>
			<label class="required" for="lastname">名:</label><br/>
			<input type="text" id="lastname" class="full" value="" name="lastname"/>
		</p>
		<p>
			<label class="required">性别:</label><br/>
			<input type="radio" id="sex-m" class="" value="男" name="sex"/>
			<label class="choice" for="sex-m">男</label>
			<input type="radio" id="sex-f" class="" value="女" name="sex"/>
			<label class="choice" for="sex-f">女</label>
		</p>
		<p>
			<label class="required" for="email">电子邮箱:</label><br/>
			<input type="text" id="email" class="full" value="" name="email"/>
		</p>
		<p class="box">
			<input type="submit" class="btn btn-green big" value="提交"/>&nbsp;&nbsp;或&nbsp;&nbsp;<input type="button" class="btn big nyroModalClose" value="取消"/>
		</p>
	</fieldset>
</form>

<script type="text/javascript">
<!--
Administry.setup();

/*
jQuery.validator.addMethod("userExist", function(value, element) {
	$.getJSON("/nebula-rest-sample/administry/user/!userExist/", { username: value }, function(json) {
		alert(json);
		return !json;
	});
}, "用户名已存在!");
*/

// validate form on keyup and submit
var validator = $("#sampleform").validate({
	onkeyup: false,
	rules: {
		password: {
			required: true,
			minlength: 5
		},
		password_confirm: {
			required: true,
			minlength: 5,
			equalTo: "#password"
		},
		firstname: "required",
		lastname: "required",
		sex: "required",
		email: {
			required: true,
			email: true
		}
	},
	messages: {
		password: {
			required: "密码不能为空！",
			minlength: jQuery.format("密码不能少于 {0} 位")
		},
		password_confirm: {
			required: "确认密码不能为空！",
			minlength: jQuery.format("确认密码不能少于 {0} 位"),
			equalTo: "确认密码与密码不一致！"
		},
		firstname: "姓不能为空！",
		lastname: "名不能为空！",
		sex: "性别不能为空！",
		email: {
			required: "请输入一个有效的邮箱地址！",
			email: "输入一个有效的邮箱地址！"
		}
	},
	// the errorPlacement has to take the layout into account
	errorPlacement: function(error, element) {
		error.insertAfter(element.parent().find('label:first'));
	},
	// set new class to error-labels to indicate valid fields
	success: function(label) {
		// set &nbsp; as text for IE
		label.html("&nbsp;").addClass("ok");
	},
	// specifying a submitHandler prevents the default submit, good for the demo
	submitHandler: function(form) {
		$.ajax({
			type : "PUT",
			url : "/nebula-rest-sample/administry/user/" + $("#username").val() + "/",
			data : $(form).serialize(),
			dataType : "json",
			async : true,
			contentType: "application/x-www-form-urlencoded; charset=utf-8",
			success : function(data) {
				$.nmTop().close();
				oTable.fnDraw();
			},
			error : function(XMLHttpRequest, textStatus, errorThrown) {
				alert("更新时发生错误！");
			}
		});
	}
});
//-->
</script>